@model AdvLab_WebApp.Models.RecepViewModel

@{
    ViewData["Title"] = "Delete";
}

<div class="ActionHeading">
    <div class="card panalheading">

        <h2>DELETE ORDER</h2>

    </div>
    <h3>Are you sure you want to delete this?</h3>
    <div class="col-12 col-md-12 col-sm-12">
        <form id="OrderDeleteForm1" enctype="multipart/form-data" asp-action="Delete">
            <input type="hidden" asp-for="DescCashier.LabNo" name="id" />
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <p>
                <a asp-action="Index">
                    <i class="fa fa-arrow-left BtnIcon2 HomeIcon"></i>
                </a>
                <a href="#" id="submitButton">
                    <i class="fa fa-trash BtnIcon1 HomeIcon"></i>
                </a>
            </p>
            <div class="row">
                <div class="col-md-4">
                    <div style="padding-left:10px;padding-right:10px;">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="row" style="border-right: groove;border-bottom: groove;border-left: groove;border-top: groove;padding: 10px 0px 10px 0px;">
                                    <div class="col-md-7">
                                        <div class="form-group">
                                            @* style="display:none"> *@
                                            <div class="form-group col-8 p-0">

                                                <div class="custom-file">
                                                    <input asp-for="PatReg.ProfilePhoto" class="custom-file-input" id="customfile"
                                                           onchange="document.getElementById('PreviewPhoto').src=window.URL.createObjectURL(this.files[0])" />
                                                </div>

                                                <span asp-validation-for="PatReg.ProfilePhoto" class="text-danger"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group col-4">
                                            <img src="~/images/@Model.PatReg.PhotoUrl" id="PreviewPhoto" alt="Logo Image" class="avatar"
                                                 onerror="this.onerror=null; this.src='~/images/NoImage.jpg';
                                                 width="125" height="125" style="border:1px; margin-top:0px;border-radius: 50%;" />

                                            <img id="PreviewPhoto1" src="~/images/NoImage.jpg" alt="Logo Image"
                                                 width="125" height="125" style="border:1px; margin-top:0px;border-radius: 50%; display:none" />

                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="row" style="border-right: groove;border-bottom: groove;border-left: groove;padding: 10px 0px 10px 0px;">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label asp-for="PatReg.Initial" class="control-label">Initial</label>
                                            <select asp-for="PatReg.Initial" asp-items="@(new SelectList(ViewBag.InitialList, "Value", "Text", Model.PatReg.Initial))" class="form-control">
                                            </select>
                                            @* <input asp-for="PatReg.Initial" class="form-control" /> *@
                                            <span asp-validation-for="PatReg.Initial" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="form-group">
                                            <label asp-for="PatReg.FirstName" class="control-label">Patient Name</label>
                                            <input asp-for="PatReg.FirstName" class="form-control" />
                                            <span asp-validation-for="PatReg.FirstName" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label asp-for="PatReg.Relation" class="control-label">Relation of</label>
                                            <select asp-for="PatReg.Relation" asp-items="@(new SelectList(ViewBag.RelationList, "Value", "Text", Model.PatReg.Relation))" class="form-control">
                                            </select>
                                            @* <input asp-for="PatReg.Relation" class="form-control" /> *@
                                            <span asp-validation-for="PatReg.Relation" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="form-group">
                                            <label asp-for="PatReg.RelName" class="control-label">Relation Name</label>
                                            <input asp-for="PatReg.RelName" class="form-control" />
                                            <span asp-validation-for="PatReg.RelName" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label asp-for="PatReg.Age" class="control-label">Age</label>
                                            <input asp-for="PatReg.Age" class="form-control" />
                                            <span asp-validation-for="PatReg.Age" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label asp-for="PatReg.AgeType" class="control-label">Type</label>
                                            <select asp-for="PatReg.AgeType" asp-items="@(new SelectList(ViewBag.AgeTypeList, "Value", "Text", Model.PatReg.AgeType))" class="form-control">
                                            </select>
                                            @* <input asp-for="PatReg.AgeType" class="form-control" /> *@
                                            <span asp-validation-for="PatReg.AgeType" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="form-group">
                                            <label asp-for="PatReg.Gender" class="control-label">Gender</label>
                                            <select asp-for="PatReg.Gender" asp-items="@(new SelectList(ViewBag.GenderList, "Value", "Text", Model.PatReg.Gender))" class="form-control">
                                            </select>
                                            @* <input asp-for="PatReg.Gender" class="form-control" /> *@
                                            <span asp-validation-for="PatReg.Gender" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label asp-for="PatReg.DBO" class="control-label">Date of Birth</label>
                                            <input asp-for="PatReg.DBO" class="form-control" placeholder="mm/dd/yyyy" oninput="formatDate(this)" />
                                            <span asp-validation-for="PatReg.DBO" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label asp-for="PatReg.ContNo" class="control-label">Contact #</label>
                                            <input asp-for="PatReg.ContNo" class="form-control" />
                                            <span asp-validation-for="PatReg.ContNo" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label asp-for="PatReg.Email" class="control-label">Email Address</label>
                                            <input asp-for="PatReg.Email" class="form-control" />
                                            <span asp-validation-for="PatReg.Email" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="col-md-12">
                        <div class="row" style="border-right: groove;border-bottom: groove;border-left: groove;border-top: groove;padding: 10px 0px 10px 0px;">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label asp-for="DescCashier.ClientID" class="control-label">Client Name</label>
                                    <input asp-for="DescCashier.ClientID" id="Txt_ClientID" hidden class="form-control" />
                                    <input id="Txt_PerA" name="Txt_PerA" hidden />
                                    <input type="text" id="Txt_ClientName" class="form-control" />
                                    <span asp-validation-for="DescCashier.ClientID" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label asp-for="DescCashier.ClientNo" class="control-label">Client #</label>
                                    <input asp-for="DescCashier.ClientNo" class="form-control" />
                                    <span asp-validation-for="DescCashier.ClientNo" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="form-group">
                                    <label asp-for="DescCashier.ConsName" class="control-label">Consultant Name</label>
                                    <input asp-for="DescCashier.ConsName" class="form-control" />
                                    <span asp-validation-for="DescCashier.ConsName" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="row">
                            <table id="DescLabTable" class="table table-striped table-sm">
                                <thead>
                                    <tr>
                                        <th>
                                            Description
                                        </th>

                                        <th style="width:80px;">Price</th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @for (int i = 0; i < Model.DescCashier.DescLabs.Count; i++)
                                    {
                                        <tr>
                                            <td>
                                                <input asp-for="@Model.DescCashier.DescLabs[i].DescID" id="Txt_DescID-@i" hidden class="form-control" />
                                                <input asp-for="@Model.DescCashier.DescLabs[i].DescID" id="Txt_DescName-@i" readonly class="form-control" type="text" value="" />
                                                <input asp-for="@Model.DescCashier.DescLabs[i].DStatus" id="Txt_Status-@i" hidden class="form-control" type="text" value="Invoice" />
                                            </td>
                                            <td style="width:80px;">
                                                <input asp-for="@Model.DescCashier.DescLabs[i].Charges" id="Txt_Price-@i" readonly class="form-control" />
                                            </td>
                                            <td style="vertical-align: middle;width: 80px;">
                                                <button id="btndummy-@i" type="button" hidden="hidden">Dummy</button>
                                                <button id="btnadd-@i" type="button" class="btn btn-sm btn-secondary invisible"
                                                        onclick="AddItem(this)" style="width: 80px;">
                                                    Add
                                                </button>

                                            </td>
                                            <td style="vertical-align: middle;width: 80px;">
                                                <button id="btnremove-@i" type="button" class="btn btn-sm btn-danger visible"
                                                        onclick="DeleteItem(this)" style="width: 80px;">
                                                    Remove
                                                </button>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div style="padding-left:10px;padding-right:10px;">
                        <div class="row" style="border-right: groove;border-bottom: groove;border-left: groove;border-top: groove;padding: 10px 0px 10px 0px;">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label asp-for="DescCashier.PaymentMode" class="control-label" id="lbl_PaymentMode">Payment Mode</label>
                                    <select asp-for="DescCashier.PaymentMode" class="form-control" id="txt_PaymentMode">
                                        <option value="Cash">Cash</option>
                                        <option value="Credit Card">Credit Card</option>
                                        <option value="OTP">OTP</option>
                                        <option value="Online Transfer">Online Transfer</option>
                                        <!-- Add more options as needed -->
                                    </select>
                                    @* <input asp-for="DescCashier.PaymentMode" class="form-control" /> *@
                                    <span asp-validation-for="DescCashier.PaymentMode" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label asp-for="DescCashier.CreditCardNo" class="control-label" id="lbl_CreditCardNo">Transaction No</label>
                                    <input asp-for="DescCashier.CreditCardNo" class="form-control" id="txt_CreditCardNo" readonly />
                                    <span asp-validation-for="DescCashier.CreditCardNo" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label asp-for="DescCashier.GrossA" class="control-label">Gross Amount</label>
                                    <input asp-for="DescCashier.GrossA" class="form-control" readonly />
                                    <span asp-validation-for="DescCashier.GrossA" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label asp-for="DescCashier.DiscPer" class="control-label" style="text-wrap: nowrap;">Discount Percent ( <input id="DiscountAllow" value="0" style="color:red; border:none; width: 30px;background: none;" /> ) </label>
                                    <input asp-for="DescCashier.DiscPer" class="form-control" />

                                    <span asp-validation-for="DescCashier.DiscPer" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label asp-for="DescCashier.Discount" class="control-label">Discount Amount</label>
                                    <input asp-for="DescCashier.Discount" class="form-control" />
                                    <span asp-validation-for="DescCashier.Discount" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label asp-for="DescCashier.TotalA" class="control-label">Net Amount</label>
                                    <input asp-for="DescCashier.TotalA" class="form-control" readonly />
                                    <span asp-validation-for="DescCashier.TotalA" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label asp-for="DescCashier.PaidA" class="control-label">Received Amount</label>
                                    <input asp-for="DescCashier.PaidA" class="form-control" />
                                    <span asp-validation-for="DescCashier.PaidA" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label asp-for="DescCashier.BlanceA" class="control-label" style="text-wrap: nowrap;">Balance Amount ( <input id="BalanceAllow" value="0" style="color:red; border:none; width: 30px;background: none;" /> ) </label>
                                    <input asp-for="DescCashier.BlanceA" class="form-control" readonly />
                                    <span asp-validation-for="DescCashier.BlanceA" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="form-group">
                        <input type="hidden" id="hdnLastIndex" value="0" />

                        <div class="col-12 btn-group">
                            <div class="col-6 form-group text-left p-2">


                                @* <input type="submit" value="Create" class="btn btn-primary" /> *@
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <br />

        </form>
    </div>
</div>
<hr />
@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.validation.unobtrusive/3.2.11/jquery.validate.unobtrusive.min.js"></script>

    <script>
        $(document).ready(function () {
            $(document).on("change", "#PatReg_Initial", function () {
                var InitialValue = $(this).val();
                $.ajax({
                    url: "/Reception/GetDefaultNameKeys",
                    method: "POST",
                    data: { InitialValue: InitialValue },
                    success: function (response) {
                        // Set the values for Relation, AgeType, and Gender fields
                        $("#PatReg_Initial").val(response.initial);
                        $("#PatReg_Relation").val(response.relation);
                        $("#PatReg_AgeType").val(response.ageType);
                        $("#PatReg_Gender").val(response.gender);
                        console.log(response);
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            });
        });
        $(document).ready(function () {
            $('#txt_PaymentMode').change(function () {
                var selectedOption = $(this).val();
                if (selectedOption === 'Credit Card') {
                    $('#lbl_CreditCardNo').text('Credit Card No');
                    $('#txt_CreditCardNo').prop('readonly', false);
                }
                else if (selectedOption === 'OTP') {
                    $('#lbl_CreditCardNo').text('OTP No');
                    $('#txt_CreditCardNo').prop('readonly', false);
                }
                else if (selectedOption === 'Online Transfer') {
                    $('#lbl_CreditCardNo').text('Transaction No');
                    $('#txt_CreditCardNo').prop('readonly', false);
                }
                else {
                    $('#lbl_CreditCardNo').text('Transaction No');
                    $('#txt_CreditCardNo').prop('readonly', true);
                }
            });
        });
        $(document).on("change", "#DescCashier_Discount", async function () {
            var DiscountAllow1 = parseFloat($('#DiscountAllow').val()) || 0;
            var grossA = parseFloat($('#DescCashier_GrossA').val()) || 0;
            var discount = parseFloat($('#DescCashier_Discount').val()) || 0;
            $('#DescCashier_Discount').val(parseFloat($('#DescCashier_Discount').val()) || 0);
            $('#DescCashier_GrossA').val(parseFloat($('#DescCashier_GrossA').val()) || 0);
            var total = grossA - discount;
            $('#DescCashier_TotalA').val(total.toFixed(0));
            $('#DescCashier_PaidA').val(total.toFixed(0));
            var discountByPercent = 0;
            if (grossA !== 0 && total !== 0) {
                discountByPercent = ((grossA - total) / grossA) * 100;
            } else if (discount !== 0 && grossA !== 0) {
                discountByPercent = (discount / grossA) * 100;
            }
            $('#DescCashier_BlanceA').val(0);
            $('#DescCashier_DiscPer').val(discountByPercent.toFixed(2));
            if (discountByPercent > DiscountAllow1) {
                $("span.text-danger[asp-validation-for='DescCashier.DiscPer']").html("Discount percentage exceeds allowed limit.");
                var grossA = parseFloat($('#DescCashier_GrossA').val()) || 0;
                var discount = (grossA * DiscountAllow1) / 100; // Calculate discount based on discount percentage
                $('#DescCashier_Discount').val(discount.toFixed(2)); // Update DescCashier_Discount with calculated discount

                var total = grossA - discount;
                $('#DescCashier_DiscPer').val(DiscountAllow1);
                $('#DescCashier_TotalA').val(total.toFixed(0));
                $('#DescCashier_PaidA').val(total.toFixed(0));

                $('#DescCashier_BlanceA').val(0);
            }
            else {
                $("span.text-danger[asp-validation-for='DescCashier.DiscPer']").html("");
            }
        });
        $(document).on("change", "#DescCashier_DiscPer", async function () {
            var DiscountAllow1 = parseFloat($('#DiscountAllow').val()) || 0;
            var grossA = parseFloat($('#DescCashier_GrossA').val()) || 0;
            var discountByPercent = parseFloat($(this).val()) || 0; // Updated line to get value of DescCashier.DiscPer
            var discount = (grossA * discountByPercent) / 100; // Calculate discount based on discount percentage
            $('#DescCashier_Discount').val(discount.toFixed(2)); // Update DescCashier_Discount with calculated discount

            var total = grossA - discount;
            $('#DescCashier_TotalA').val(total.toFixed(0));
            $('#DescCashier_PaidA').val(total.toFixed(0));

            $('#DescCashier_BlanceA').val(0);

            if (discountByPercent > DiscountAllow1) {
                $("span.text-danger[asp-validation-for='DescCashier.DiscPer']").html("Discount percentage exceeds allowed limit.");
                var grossA = parseFloat($('#DescCashier_GrossA').val()) || 0;
                var discount = (grossA * DiscountAllow1) / 100; // Calculate discount based on discount percentage
                $('#DescCashier_Discount').val(discount.toFixed(2)); // Update DescCashier_Discount with calculated discount

                var total = grossA - discount;
                $('#DescCashier_DiscPer').val(DiscountAllow1);
                $('#DescCashier_TotalA').val(total.toFixed(0));
                $('#DescCashier_PaidA').val(total.toFixed(0));

                $('#DescCashier_BlanceA').val(0);
            } else {
                $("span.text-danger[asp-validation-for='DescCashier.DiscPer']").html("");
            }
        });
        $(document).ready(function () {
            $(document).on("change", "#DescCashier_PaidA", function () {
                var paidA = parseFloat($('#DescCashier_PaidA').val()) || 0;
                var totalA = parseFloat($('#DescCashier_TotalA').val()) || 0;
                var BalancePerAllow = parseFloat($('#BalanceAllow').val()) || 0;
                if (paidA !== totalA) {
                    var balanceA = totalA - paidA;
                    var balanceCompressionPrice = totalA / 100 * BalancePerAllow;
                    if (balanceA > balanceCompressionPrice) {
                        paidA = totalA - balanceCompressionPrice;
                        $('#DescCashier_BlanceA').val(balanceCompressionPrice);
                        $('#DescCashier_PaidA').val(paidA);
                    }
                    else {
                        $('#DescCashier_BlanceA').val(balanceA.toFixed(0));
                    }
                } else {
                    $('#DescCashier_BlanceA').val(0);
                }
            });
        });
        document.getElementById("submitButton").addEventListener("click", function (event) {
            event.preventDefault(); // Prevent the default behavior of the <a> tag
            document.getElementById("OrderDeleteForm1").submit(); // Submit the form
        });
    </script>
    <script type="text/javascript">
        $(".custom-file-input").on("change", function () {
            var fileName = $(this).val().split("\\").pop();
            $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
        });

        function DeleteItem(btn) {
            $(btn).closest('tr').remove();
            var totalCharges = 0;
            $('[id^=Txt_Price]').each(function () {
                totalCharges += parseInt($(this).val()) || 0;
            });
            $('#DescCashier_GrossA').val(totalCharges);
            $('#DescCashier_TotalA').val(totalCharges);
            $('#DescCashier_PaidA').val(totalCharges);


            var lastrowIdx = document.getElementById('hdnLastIndex').value;
            var secondLastRow = lastrowIdx - 1;
            document.getElementById('hdnLastIndex').value = secondLastRow;
            var btnAddID = "btnadd-" + secondLastRow;
            var addbtn = document.getElementById(btnAddID);
            addbtn.classList.remove("invisible");
            addbtn.classList.add("visible");
        }
        function AddItem(btn) {

            var table = document.getElementById('DescLabTable');
            var rows = table.getElementsByTagName('tr');
            var rowOuterHtml = rows[rows.length - 1].outerHTML;
            var lastrowIdx = document.getElementById('hdnLastIndex').value;
            var nextrowIdx = eval(lastrowIdx) + 1;
            document.getElementById('hdnLastIndex').value = nextrowIdx;
            rowOuterHtml = rowOuterHtml.replaceAll('' + lastrowIdx + '', '' + nextrowIdx + '');
            rowOuterHtml = rowOuterHtml.replaceAll('[' + lastrowIdx + ']', '[' + nextrowIdx + ']');
            rowOuterHtml = rowOuterHtml.replaceAll('-' + lastrowIdx, '-' + nextrowIdx);
            var newRow = table.insertRow();
            newRow.innerHTML = rowOuterHtml;
            var btnAddID = btn.id;
            var btnDeleteid = btnAddID.replaceAll('btnadd', 'btnremove');
            var delbtn = document.getElementById(btnDeleteid);
            delbtn.classList.add("visible");
            delbtn.classList.remove("invisible");
            var addbtn = document.getElementById(btnAddID);
            addbtn.classList.remove("visible");
            addbtn.classList.add("invisible");
            $('#Txt_DescID-' + nextrowIdx).val(0);
            $('#Txt_Price-' + nextrowIdx).val(0);
            $('#Txt_DescName-' + (nextrowIdx - 1)).prop('readonly', true);
            $('#Txt_DescName-' + (nextrowIdx)).prop('readonly', false);

            var totalCharges = 0;
            $('[id^=Txt_Price]').each(function () {
                totalCharges += parseInt($(this).val()) || 0;
            });
            $('#DescCashier_GrossA').val(totalCharges);
            $('#DescCashier_TotalA').val(totalCharges);
            $('#DescCashier_PaidA').val(totalCharges);
            $('#Txt_DescName-' + nextrowIdx).focus();
            //rebindvalidation();
        }

        function rebindvalidation() {
            var $form = $("ApplicantForm");
            $form.unbind();
            $form.data("validator", null)
            $.validator.unobtrusive.parse($form);
            $form.validator($form.data("unobtrusiveValidation").options);
        }

    </script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        $(function () {

            $('#Txt_ClientName').autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '/Reception/ClientsearchingEvent',
                        method: 'GET',
                        data: { searchTerm: request.term },
                        success: function (data) {
                            response(data.map(function (item) {
                                return {

                                    label: item.clientName,
                                    value: item.clientName,
                                    clientID: item.clientID,
                                    location: item.location,
                                    perA: item.perA,
                                    discountPerAllow: item.discountPerAllow,
                                    balancePerAllow: item.balancePerAllow
                                };
                            }));
                        },
                        error: function (error) {
                            console.error(error);
                        }
                    });
                },
                minLength: 3,
                select: function (event, ui) {
                    console.log(ui.item);
                    $('#Txt_ClientID').val(ui.item.clientID);
                    $('#Txt_PerA').val(ui.item.perA);//BalanceAllow
                    $('#DiscountAllow').val(ui.item.discountPerAllow);
                    $('#BalanceAllow').val(ui.item.balancePerAllow);
                    $('#Txt_DescName-0').focus();
                }
            });
        });
        window.onload = function () {
            var searchTerm = $('#Txt_ClientID').val();
            if (searchTerm != 0 && searchTerm != null) { // Adjust the minimum length as needed
                $.ajax({
                    url: '/Reception/ClientIDzsearchingEvent',
                    method: 'GET',
                    data: { searchTerm: searchTerm },
                    success: function (data) {

                        console.log(data); // Log the received data to console for verification
                        $('#clientList').empty();
                        $.each(data, function (index, item) {
                            console.log(item.clientID, item.clientName, item.location, item.perA, item.discountPerAllow, item.balancePerAllow); // Log each item to verify
                            $('#clientList').append($('<option>', {
                                value: item.clientID,
                                text: item.clientName,
                                location: item.location,
                                perA: item.perA,
                                discountPerAllow: item.discountPerAllow,
                                balancePerAllow: item.balancePerAllow
                            }));

                            $('#Txt_ClientName').val(item.clientName);
                            $('#Txt_PerA').val(item.perA);
                            $('#DiscountAllow').val(item.discountPerAllow);
                            $('#BalanceAllow').val(item.balancePerAllow);
                        });
                    },
                    error: function (error) {
                        console.error(error);
                    }
                });
            }

            var searchTermArr = [];
            $('[id^="Txt_DescID-"]').each(function () {
                debugger;
                searchTermArr.push($(this).val());
                //document.getElementById('hdnLastIndex').value = +1 ;
                document.getElementById('hdnLastIndex').value = parseInt(document.getElementById('hdnLastIndex').value) + 1;

            });

            searchTermArr.forEach(function (searchTerm) {

                if (searchTerm != 0 && searchTerm != null) {
                    $.ajax({
                        url: '/Reception/DescriptionIDzsearchingEvent',
                        method: 'GET',
                        data: { searchTerm: searchTerm },
                        success: function (data) {
                            $('#clientList').empty();
                            $.each(data, function (index, item) {
                                $('#clientList').append($('<option>', {
                                    value: item.descID,
                                    text: item.descName,
                                }));

                                var $parentTd = $('[id^="Txt_DescID-"][value="' + searchTerm + '"]').closest('td');
                                $parentTd.find('[id^="Txt_DescID-"]').val(item.descID);
                                debugger;
                                $parentTd.find('[id^="Txt_DescName-"]').val(item.descName);
                                var nextrowIdx = document.getElementById('hdnLastIndex').value;
                                //$('#Txt_DescName-' + nextrowIdx).val('');
                                $('#Txt_DescID-' + nextrowIdx).val('');
                                $('#Txt_Price-' + nextrowIdx).val('');
                                $('#Txt_DescName-' + nextrowIdx).val('');
                                $('#Txt_DescName-' + (nextrowIdx)).prop('readonly', false);
                            });
                        },
                        error: function (error) {
                            console.error(error);
                        }
                    });
                }
            });
            debugger;
            //document.getElementById('hdnLastIndex').value = '0';

            var table = document.getElementById('DescLabTable');
            var rows = table.getElementsByTagName('tr');
            var rowOuterHtml = rows[rows.length - 1].outerHTML;
            var lastrowIdx = parseInt(document.getElementById('hdnLastIndex').value) - 1;
            var nextrowIdx = eval(lastrowIdx) + 1;
            document.getElementById('hdnLastIndex').value = nextrowIdx;
            rowOuterHtml = rowOuterHtml.replaceAll('' + lastrowIdx + '', '' + nextrowIdx + '');
            rowOuterHtml = rowOuterHtml.replaceAll('[' + lastrowIdx + ']', '[' + nextrowIdx + ']');
            rowOuterHtml = rowOuterHtml.replaceAll('-' + lastrowIdx, '-' + nextrowIdx);
            var newRow = table.insertRow();
            newRow.innerHTML = rowOuterHtml;
            var btnAddID = "btnadd-" + nextrowIdx;
            var btnDeleteid = "btnremove-" + nextrowIdx;
            var delbtn = document.getElementById(btnDeleteid);
            delbtn.classList.add("visible");
            delbtn.classList.remove("invisible");
            var addbtn = document.getElementById(btnAddID);
            addbtn.classList.add("visible");
            addbtn.classList.remove("invisible");


        };
    </script>
    <script>
        $(function () {
            $(document).on('focus', '[id^="Txt_DescName-"]', function () {
                $(this).autocomplete({
                    source: function (request, response) {
                        $.ajax({
                            url: '/Reception/DescriptionsearchingEvent',
                            method: 'GET',
                            data: {
                                searchTerm: request.term,
                                clientID: $('#Txt_ClientID').val()
                            },
                            success: function (data) {
                                response(data.map(function (item) {
                                    return {
                                        label: item.descName,
                                        value: item.descName,
                                        descID: item.descID,
                                        price: item.price
                                    };
                                }));
                            },
                            error: function (error) {
                                console.error(error);
                            }
                        });
                    },
                    minLength: 3,
                    select: function (event, ui) {
                        var $parentTd = $(this).closest('td');
                        $parentTd.find('[id^="Txt_DescID-"]').val(ui.item.descID);
                        $parentTd.next('td').find('[id^="Txt_Price-"]').val(ui.item.price);
                    }
                });
            });
        });
        function formatDate(input) {
            let value = input.value;
            let numericValue = value.replace(/\D/g, '');
            let formattedValue = numericValue.replace(/^(\d{2})(\d{2})(\d{4})$/, '$1/$2/$3');
            input.value = formattedValue;
        }
    </script>
}